<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company OS - Erweitert</title>
    <link rel="stylesheet" href="styles.css">
    <!-- JavaScript Dateien wurden ans Ende der Datei verschoben -->
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>Company OS</h1>
            <p>Business Management Suite</p>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <!-- Waren Übersicht -->
                <li>
                    <button class="active" onclick="toggleDropdown('waren-dropdown'); showTab('calculator')">📊 <span>Waren Übersicht</span></button>
                    <ul class="dropdown active" id="waren-dropdown">
                        <li><button onclick="showTab('items')">📦 <span>Items</span></button></li>
                        <li><button onclick="showTab('materials')">🏭 <span>Materialien</span></button></li>
                    </ul>
                </li>
                
                <!-- Kunden -->
                <li>
                    <button onclick="toggleDropdown('customers-dropdown'); showTab('customers-overview')">👤 <span>Kunden</span></button>
                    <ul class="dropdown" id="customers-dropdown">
                        <li><button onclick="showTab('customers-management')">⚙️ <span>Verwaltung</span></button></li>
                        <li><button onclick="showTab('customers-overview')">📋 <span>Übersicht</span></button></li>
                    </ul>
                </li>
                
                <!-- Zeitliche Buchung -->
                <li>
                    <button onclick="toggleDropdown('bookings-dropdown'); showTab('time-bookings')">🎱 <span>Zeitbuchungen</span></button>
                    <ul class="dropdown" id="bookings-dropdown">
                        <li><button onclick="showTab('time-bookings')">⏰ <span>Neue Buchung</span></button></li>
                        <li><button onclick="showTab('bookings-overview')">📅 <span>Übersicht</span></button></li>
                        <li><button onclick="showTab('activities-management')">🎯 <span>Angebote verwalten</span></button></li>
                    </ul>
                </li>
                
                <!-- Verkauf -->
                <li>
                    <button onclick="toggleDropdown('sales-dropdown'); showTab('sales-daily')">💰 <span>Verkauf</span></button>
                    <ul class="dropdown" id="sales-dropdown">
                        <li><button onclick="showTab('sales-daily')">🗓️ <span>Tagesverkauf</span></button></li>
                        <li><button onclick="showTab('sales-overview')">📊 <span>Verkaufsübersicht</span></button></li>
                    </ul>
                </li>
                
                <!-- Einkauf -->
                <li>
                    <button onclick="toggleDropdown('purchases-dropdown'); showTab('material-purchases')">🛒 <span>Einkauf</span></button>
                    <ul class="dropdown" id="purchases-dropdown">
                        <li><button onclick="showTab('material-purchases')">📦 <span>Materialeinkauf</span></button></li>
                        <li><button onclick="showTab('purchases-overview')">📋 <span>Einkaufsübersicht</span></button></li>
                    </ul>
                </li>
                
                <!-- Bilanz -->
                <li>
                    <button onclick="toggleDropdown('bilanz-dropdown'); showTab('bilanz-daily')">📈 <span>Bilanz</span></button>
                    <ul class="dropdown" id="bilanz-dropdown">
                        <li><button onclick="showTab('bilanz-daily')">📅 <span>Tagesbilanz</span></button></li>
                        <li><button onclick="showTab('bilanz-weekly')">📊 <span>Wochenbilanz</span></button></li>
                        <li><button onclick="showTab('bilanz-monthly')">📈 <span>Monatsbilanz</span></button></li>
                    </ul>
                </li>
                
                <!-- Mitarbeiter -->
                <li>
                    <button onclick="toggleDropdown('employees-dropdown'); showTab('employees-overview')">👥 <span>Mitarbeiter</span></button>
                    <ul class="dropdown" id="employees-dropdown">
                        <li><button onclick="showTab('employees-management')">⚙️ <span>Verwaltung</span></button></li>
                        <li><button onclick="showTab('employees-overview')">📋 <span>Übersicht</span></button></li>
                        <li><button onclick="showTab('time-tracking')">⏰ <span>Stundenerfassung</span></button></li>
                    </ul>
                </li>
                
                <!-- Einstellungen -->
                <li>
                    <button onclick="toggleDropdown('settings-dropdown'); showTab('settings')">⚙️ <span>Einstellungen</span></button>
                    <ul class="dropdown" id="settings-dropdown">
                        <li><button onclick="showTab('settings')">🎨 <span>Themes</span></button></li>
                        <li><button onclick="showTab('backup')">💾 <span>Backup</span></button></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        
        <!-- Waren Calculator Tab -->
        <div class="tab-content active" id="calculator">
            <div class="tab-header">
                <h1>📊 Waren Übersicht</h1>
                <p>Kosten-Kalkulation und Gewinnmarge-Analyse</p>
            </div>
            <div id="calculator-content">
                <!-- Calculator content wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Items Tab -->
        <div class="tab-content" id="items">
            <div class="tab-header">
                <h1>📦 Items</h1>
                <p>Verwalten Sie Ihre verkaufbaren Artikel</p>
                <button class="btn btn-success" onclick="initDatabase(); showModal('itemModal')">+ Neues Item</button>
            </div>
            <div id="items-list">
                <!-- Items liste wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Materials Tab -->
        <div class="tab-content" id="materials">
            <div class="tab-header">
                <h1>🏭 Materialien</h1>
                <p>Verwalten Sie Ihre Materialien und Rohstoffe</p>
                <button class="btn btn-success" onclick="initDatabase(); showModal('materialModal')">+ Neues Material</button>
            </div>
            <div id="materials-list">
                <!-- Materials liste wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Customers Overview Tab -->
        <div class="tab-content" id="customers-overview">
            <div class="tab-header">
                <h1>👤 Kunden-Übersicht</h1>
                <p>Übersicht aller Kunden mit Statistiken</p>
            </div>
            <div id="customers-overview-content">
                <!-- Customers overview wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Customers Management Tab -->
        <div class="tab-content" id="customers-management">
            <div class="tab-header">
                <h1>👤 Kunden-Verwaltung</h1>
                <p>Kunden hinzufügen, bearbeiten und verwalten</p>
                <button class="btn btn-success" onclick="showModal('customerModal')">+ Neuer Kunde</button>
            </div>
            <div id="customers-management-list">
                <!-- Customers liste wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Time Bookings Tab -->
        <div class="tab-content" id="time-bookings">
            <div class="tab-header">
                <h1>🎱 Zeitbuchungen</h1>
                <p>Verwalten Sie zeitbasierte Aktivitäten wie Billard, Pool, etc.</p>
            </div>
            
            <div class="card">
                <h3>Neue Zeitbuchung</h3>
                <div class="input-group">
                    <select id="newBookingCustomer" class="input-field" onchange="handleCustomerChange(this)">
                        <option value="">Laufkundschaft (Name eingeben)</option>
                    </select>
                    <input type="text" id="newBookingWalkInName" class="input-field" placeholder="Name für Laufkundschaft" style="display: block;">
                    
                    <input type="date" id="newBookingDate" class="input-field">
                    <input type="time" id="newBookingStartTime" class="input-field">
                    
                    <select id="newBookingActivity" class="input-field" onchange="updateParticipantLimits(); updatePricePreview();">
                        <!-- Options werden von timeBookings.js gefüllt -->
                    </select>
                    
                    <select id="newBookingDuration" class="input-field" onchange="updatePricePreview();">
                        <!-- Options werden von timeBookings.js gefüllt -->
                    </select>
                    
                    <input type="number" id="newBookingParticipants" class="input-field" min="1" max="10" value="1" onchange="updatePricePreview();" placeholder="Teilnehmer">
                    <small id="participantsHint" style="color: var(--text-muted);"></small>
                    
                    <textarea id="newBookingNotes" class="input-field" placeholder="Notizen (optional)" rows="2"></textarea>
                </div>
                
                <div id="pricePreview" style="margin: 10px 0; font-weight: bold; font-size: 1.1rem;">
                    <!-- Preis-Vorschau wird hier angezeigt -->
                </div>
                
                <button class="btn btn-success" onclick="addTimeBooking()">🎱 Buchung hinzufügen</button>
            </div>
            
            <div class="card">
                <h3>Aktuelle Buchungen</h3>
                <div id="time-bookings-list">
                    <!-- Time bookings liste wird von ui.js gefüllt -->
                </div>
            </div>
        </div>

        <!-- Bookings Overview Tab -->
        <div class="tab-content" id="bookings-overview">
            <div class="tab-header">
                <h1>📅 Buchungsübersicht</h1>
                <p>Übersicht aller Zeitbuchungen mit Statistiken</p>
            </div>
            <div id="bookings-overview-content">
                <!-- Bookings overview wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Activities Management Tab (NEU) -->
        <div class="tab-content" id="activities-management">
            <div class="tab-header">
                <h1>🎯 Angebote verwalten</h1>
                <p>Aktivitäten und Preise anpassen</p>
                <button class="btn btn-success" onclick="showModal('activityModal')">+ Neue Aktivität</button>
            </div>
            
            <div id="activities-management-content">
                <!-- Activities management wird von ui.js gefüllt -->
            </div>
        </div>
		
		<!-- Sales Daily Tab -->
        <div class="tab-content" id="sales-daily">
            <div class="tab-header">
                <h1>💰 Tagesverkauf</h1>
                <p>Verkäufe erfassen und verwalten</p>
            </div>
            
            <div class="card">
                <h3>Neuer Verkauf</h3>
                <div class="input-group">
                    <select id="newSaleCustomer" class="input-field">
                        <option value="">Laufkundschaft</option>
                    </select>
                    <input type="date" id="newSaleDate" class="input-field">
                    <select id="newSaleType" class="input-field">
                        <option value="regular">Regulärer Verkauf</option>
                        <option value="bulk">Großbestellung</option>
                        <option value="special">Sonderverkauf</option>
                    </select>
                    <textarea id="newSaleNotes" class="input-field" placeholder="Notizen" rows="2"></textarea>
                </div>
                
                <h4>Items auswählen:</h4>
                <div id="itemSelectionList">
                    <!-- Item selection wird von sales.js gefüllt -->
                </div>
                
                <div id="saleSummary" style="margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <!-- Sale summary wird hier angezeigt -->
                </div>
                
                <button class="btn btn-success" onclick="addSale()">💰 Verkauf hinzufügen</button>
            </div>
            
            <div class="card">
                <h3>Heutige Verkäufe</h3>
                <div id="sales-daily-list">
                    <!-- Sales liste wird von ui.js gefüllt -->
                </div>
            </div>
        </div>

        <!-- Sales Overview Tab -->
        <div class="tab-content" id="sales-overview">
            <div class="tab-header">
                <h1>📊 Verkaufsübersicht</h1>
                <p>Übersicht aller Verkäufe mit Statistiken</p>
            </div>
            <div id="sales-overview-content">
                <!-- Sales overview wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Material Purchases Tab -->
        <div class="tab-content" id="material-purchases">
            <div class="tab-header">
                <h1>🛒 Materialeinkauf</h1>
                <p>Einkäufe erfassen und verwalten</p>
            </div>
            
            <div class="card">
                <h3>Neuer Einkauf</h3>
                <div class="input-group">
                    <input type="date" id="newPurchaseDate" class="input-field">
                    <select id="newPurchaseSupplier" class="input-field">
                        <option value="default">Unbekannt</option>
                    </select>
                    <select id="newPurchaseCategory" class="input-field">
                        <option value="regular">Regulärer Einkauf</option>
                    </select>
                    <input type="text" id="newPurchaseInvoice" class="input-field" placeholder="Rechnungsnummer">
                    <textarea id="newPurchaseNotes" class="input-field" placeholder="Notizen" rows="2"></textarea>
                </div>
                
                <h4>Materialien auswählen:</h4>
                <div id="materialSelectionList">
                    <!-- Material selection wird von materialPurchases.js gefüllt -->
                </div>
                
                <div id="purchaseSummary" style="margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <!-- Purchase summary wird hier angezeigt -->
                </div>
                
                <button class="btn btn-success" onclick="startNewPurchase()">🛒 Einkauf hinzufügen</button>
            </div>
            
            <div class="card">
                <h3>Aktuelle Einkäufe</h3>
                <div id="material-purchases-list">
                    <!-- Material purchases liste wird von ui.js gefüllt -->
                </div>
            </div>
        </div>

        <!-- Purchases Overview Tab -->
        <div class="tab-content" id="purchases-overview">
            <div class="tab-header">
                <h1>📋 Einkaufsübersicht</h1>
                <p>Übersicht aller Einkäufe mit Statistiken</p>
            </div>
            <div id="purchases-overview-content">
                <!-- Purchases overview wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Bilanz Tabs -->
        <div class="tab-content" id="bilanz-daily">
            <div class="tab-header">
                <h1>📅 Tagesbilanz</h1>
                <p>Finanzübersicht für einen Tag</p>
                <div class="bilanz-controls">
                    <input type="date" id="bilanzDatePicker" onchange="changeBilanzView('daily', new Date(this.value))">
                    <button class="btn" onclick="navigateBilanz('prev')">&lt; Vorheriger Tag</button>
                    <button class="btn" onclick="navigateBilanz('next')">Nächster Tag &gt;</button>
                    <button class="btn btn-success" onclick="exportBilanz()">📊 Exportieren</button>
                </div>
            </div>
            <div id="bilanz-daily-content">
                <!-- Bilanz content wird von bilanz.js gefüllt -->
            </div>
        </div>

        <div class="tab-content" id="bilanz-weekly">
            <div class="tab-header">
                <h1>📊 Wochenbilanz</h1>
                <p>Finanzübersicht für eine Woche</p>
                <div class="bilanz-controls">
                    <span id="weekRange">KW 1 (01.01.2024 - 07.01.2024)</span>
                    <button class="btn" onclick="navigateBilanz('prev')">&lt; Vorherige Woche</button>
                    <button class="btn" onclick="navigateBilanz('next')">Nächste Woche &gt;</button>
                    <button class="btn btn-success" onclick="exportBilanz()">📊 Exportieren</button>
                </div>
            </div>
            <div id="bilanz-weekly-content">
                <!-- Bilanz content wird von bilanz.js gefüllt -->
            </div>
        </div>

        <div class="tab-content" id="bilanz-monthly">
            <div class="tab-header">
                <h1>📈 Monatsbilanz</h1>
                <p>Finanzübersicht für einen Monat</p>
                <div class="bilanz-controls">
                    <span id="monthRange">Januar 2024</span>
                    <button class="btn" onclick="navigateBilanz('prev')">&lt; Vorheriger Monat</button>
                    <button class="btn" onclick="navigateBilanz('next')">Nächster Monat &gt;</button>
                    <button class="btn btn-success" onclick="exportBilanz()">📊 Exportieren</button>
                </div>
            </div>
            <div id="bilanz-monthly-content">
                <!-- Bilanz content wird von bilanz.js gefüllt -->
            </div>
        </div>

        <!-- Employees Overview Tab -->
        <div class="tab-content" id="employees-overview">
            <div class="tab-header">
                <h1>👥 Mitarbeiter-Übersicht</h1>
                <p>Übersicht aller Mitarbeiter mit Statistiken</p>
            </div>
            <div id="employees-overview-content">
                <!-- Employees overview wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Employees Management Tab -->
        <div class="tab-content" id="employees-management">
            <div class="tab-header">
                <h1>👥 Mitarbeiter-Verwaltung</h1>
                <p>Mitarbeiter hinzufügen, bearbeiten und verwalten</p>
                <button class="btn btn-success" onclick="showModal('employeeModal')">+ Neuer Mitarbeiter</button>
            </div>
            <div id="employees-management-list">
                <!-- Employees liste wird von ui.js gefüllt -->
            </div>
        </div>

        <!-- Time Tracking Tab -->
        <div class="tab-content" id="time-tracking">
            <div class="tab-header">
                <h1>⏰ Stundenerfassung</h1>
                <p>Arbeitszeiten erfassen und verwalten</p>
            </div>
            
            <div class="card">
                <h3>Neue Arbeitssession</h3>
                <div class="input-group">
                    <select id="newSessionEmployee" class="input-field">
                        <option value="">Mitarbeiter auswählen...</option>
                    </select>
                    <input type="date" id="newSessionDate" class="input-field">
                    <input type="time" id="newSessionStartTime" class="input-field">
                    <input type="time" id="newSessionEndTime" class="input-field">
                    <textarea id="newSessionDescription" class="input-field" placeholder="Beschreibung der Tätigkeiten" rows="2"></textarea>
                </div>
                <button class="btn btn-success" onclick="addWorkSession()">⏰ Session hinzufügen</button>
            </div>
            
            <div class="card">
                <h3>Arbeitssessions</h3>
                <div id="work-sessions-list">
                    <!-- Work sessions liste wird von ui.js gefüllt -->
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="tab-header">
                <h1>🎨 Theme-Einstellungen</h1>
                <p>Anpassung des Erscheinungsbilds</p>
            </div>
            
            <!-- Theme Presets -->
            <div class="card">
                <h3>🎨 Vorgefertigte Themes</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Wählen Sie ein vorgefertigtes Theme oder passen Sie die Farben individuell an.
                </p>
                <div id="preset-themes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <!-- Theme presets werden von themes.js gefüllt -->
                </div>
            </div>

            <!-- Custom Colors -->
            <div class="card">
                <h3>🎨 Individuelle Farbanpassung</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Passen Sie einzelne Farben nach Ihren Wünschen an.
                </p>
                <div id="color-settings">
                    <!-- Color settings werden von themes.js gefüllt -->
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="saveCustomTheme()">💾 Individuelles Theme speichern</button>
                    <button class="btn" onclick="exportTheme()">📤 Theme exportieren</button>
                    <button class="btn" onclick="importTheme()">📥 Theme importieren</button>
                    <button class="btn btn-warning" onclick="generateRandomTheme()">🎲 Zufälliges Theme</button>
                    <button class="btn btn-danger" onclick="resetToDefault()">🔄 Zurücksetzen</button>
                </div>
            </div>
        </div>



        <!-- Backup Tab -->
        <div class="tab-content" id="backup">
            <div class="tab-header">
                <h1>💾 Backup & Daten</h1>
                <p>Sichern und Wiederherstellen Ihrer Daten</p>
            </div>
            
            <!-- Daten-Status -->
            <div class="card">
                <h3>📊 Daten-Status</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Aktueller Status Ihrer gespeicherten Daten.
                </p>
                <div id="data-status">
                    <!-- Data status wird von database.js gefüllt -->
                </div>
            </div>

            <!-- Export -->
            <div class="card">
                <h3>📤 Daten exportieren</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Exportieren Sie alle Ihre Daten zur Sicherung.
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="exportData()">📁 Als Datei herunterladen</button>
                    <button class="btn" onclick="copyBackupToClipboard()">📋 In Zwischenablage kopieren</button>
                </div>
            </div>

            <!-- Import -->
            <div class="card">
                <h3>📥 Daten importieren</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    Importieren Sie zuvor exportierte Backup-Daten.
                    Unterstützt alle Module und Versionen.
                </p>
                
                <div style="margin-bottom: 20px;">
                    <input type="file" id="importFile" accept=".json,.txt" style="margin-bottom: 10px; color: var(--text-primary); background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 5px; padding: 8px;">
                    <button class="btn" onclick="importFromFile()">📁 Datei laden</button>
                </div>

                <div>
                    <textarea id="importText" class="input-field" placeholder="Backup-Daten hier einfügen..." rows="4" style="width: 100%; resize: vertical;"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="btn" onclick="importFromText()">📥 Daten importieren</button>
                        <button class="btn btn-danger" onclick="clearImportText()">🗑️ Text löschen</button>
                    </div>
                </div>
            </div>

            <!-- Daten zurücksetzen -->
            <div class="card" style="background: rgba(231, 76, 60, 0.2); border-left: 4px solid var(--error-color);">
                <h3 style="color: var(--error-color);">⚠️ Gefahr-Zone</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    <strong>Vorsicht!</strong> Diese Aktionen können nicht rückgängig gemacht werden.
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-danger" onclick="resetAllData()">🗑️ Alle Daten löschen</button>
                </div>
            </div>
        </div>

    </div>
	
	<!-- MODALS -->
    
    <!-- Item Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <h2>📦 Neues Item</h2>
            <div class="input-group">
                <input type="text" id="newItemName" class="input-field" placeholder="Item Name">
                <input type="number" id="newItemSellPrice" class="input-field" placeholder="Verkaufspreis" step="0.01">
            </div>
            
            <h3>Materialien hinzufügen:</h3>
            <div id="itemMaterialList">
                <!-- Material selection wird von items.js gefüllt -->
            </div>
            <button class="btn" onclick="addMaterialToItem()">+ Material hinzufügen</button>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="addItem()">📦 Item hinzufügen</button>
                <button class="btn" onclick="hideModal('itemModal')">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <h2>🏭 Neues Material</h2>
            <div class="input-group">
                <input type="text" id="newMaterialName" class="input-field" placeholder="Material Name">
                <input type="number" id="newMaterialPrice" class="input-field" placeholder="Preis pro Einheit" step="0.01">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="addMaterial()">🏭 Material hinzufügen</button>
                <button class="btn" onclick="hideModal('materialModal')">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <h2>👤 Neuer Kunde</h2>
            <div class="input-group">
                <input type="text" id="newCustomerFirstName" class="input-field" placeholder="Vorname">
                <input type="text" id="newCustomerLastName" class="input-field" placeholder="Nachname">
                <input type="email" id="newCustomerEmail" class="input-field" placeholder="E-Mail (optional)">
                <input type="tel" id="newCustomerPhone" class="input-field" placeholder="Telefon (optional)">
                <select id="newCustomerType" class="input-field">
                    <option value="Standard">Standard</option>
                    <option value="Premium">Premium</option>
                    <option value="VIP">VIP</option>
                </select>
                <input type="number" id="newCustomerDiscount" class="input-field" placeholder="Rabatt %" min="0" max="100" value="0">
                <textarea id="newCustomerNotes" class="input-field" placeholder="Notizen (optional)" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="addCustomer()">👤 Kunde hinzufügen</button>
                <button class="btn" onclick="hideModal('customerModal')">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <h2>👤 Kunde bearbeiten</h2>
            <div class="input-group">
                <input type="text" id="editCustomerFirstName" class="input-field" placeholder="Vorname">
                <input type="text" id="editCustomerLastName" class="input-field" placeholder="Nachname">
                <input type="email" id="editCustomerEmail" class="input-field" placeholder="E-Mail (optional)">
                <input type="tel" id="editCustomerPhone" class="input-field" placeholder="Telefon (optional)">
                <select id="editCustomerType" class="input-field">
                    <option value="Standard">Standard</option>
                    <option value="Premium">Premium</option>
                    <option value="VIP">VIP</option>
                </select>
                <input type="number" id="editCustomerDiscount" class="input-field" placeholder="Rabatt %" min="0" max="100">
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editCustomerActive" checked>
                    <span>Kunde ist aktiv</span>
                </label>
                <textarea id="editCustomerNotes" class="input-field" placeholder="Notizen (optional)" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveCustomerEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeCustomerEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Activity Modal (NEU) -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <h2>🎯 Neue Aktivität</h2>
            <div class="input-group">
                <input type="text" id="newActivityName" class="input-field" placeholder="Aktivitätsname">
                <select id="newActivityCategory" class="input-field">
                    <option value="Tischspiele">🎱 Tischspiele</option>
                    <option value="Wurfspiele">🎯 Wurfspiele</option>
                    <option value="Ballspiele">🏓 Ballspiele</option>
                    <option value="Gaming">🎮 Gaming</option>
                    <option value="Sport">🏃 Sport</option>
                    <option value="Entspannung">🛋️ Entspannung</option>
                </select>
                <input type="text" id="newActivityIcon" class="input-field" placeholder="Icon (Emoji)" maxlength="2" value="🎯">
                <input type="color" id="newActivityColor" class="input-field" value="#3498db">
                <input type="number" id="newActivityHalfHourRate" class="input-field" placeholder="30-Min Preis" step="0.01" value="5.00">
                <input type="number" id="newActivityFullHourRate" class="input-field" placeholder="60-Min Preis" step="0.01" value="10.00">
                <input type="number" id="newActivityMaxCapacity" class="input-field" placeholder="Max. Teilnehmer" min="1" max="50" value="2">
                <textarea id="newActivityDescription" class="input-field" placeholder="Beschreibung" rows="2"></textarea>
                <input type="text" id="newActivityEquipment" class="input-field" placeholder="Ausrüstung (kommagetrennt)">
                <textarea id="newActivityRules" class="input-field" placeholder="Regeln (optional)" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="addActivity()">🎯 Aktivität hinzufügen</button>
                <button class="btn" onclick="hideModal('activityModal')">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Activity Modal (NEU) -->
    <div id="editActivityModal" class="modal">
        <div class="modal-content">
            <h2>🎯 Aktivität bearbeiten</h2>
            <div class="input-group">
                <input type="text" id="editActivityName" class="input-field" placeholder="Aktivitätsname">
                <select id="editActivityCategory" class="input-field">
                    <option value="Tischspiele">🎱 Tischspiele</option>
                    <option value="Wurfspiele">🎯 Wurfspiele</option>
                    <option value="Ballspiele">🏓 Ballspiele</option>
                    <option value="Gaming">🎮 Gaming</option>
                    <option value="Sport">🏃 Sport</option>
                    <option value="Entspannung">🛋️ Entspannung</option>
                </select>
                <input type="text" id="editActivityIcon" class="input-field" placeholder="Icon (Emoji)" maxlength="2">
                <input type="color" id="editActivityColor" class="input-field">
                <input type="number" id="editActivityHalfHourRate" class="input-field" placeholder="30-Min Preis" step="0.01">
                <input type="number" id="editActivityFullHourRate" class="input-field" placeholder="60-Min Preis" step="0.01">
                <input type="number" id="editActivityMaxCapacity" class="input-field" placeholder="Max. Teilnehmer" min="1" max="50">
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editActivityActive" checked>
                    <span>Aktivität ist aktiv</span>
                </label>
                <textarea id="editActivityDescription" class="input-field" placeholder="Beschreibung" rows="2"></textarea>
                <input type="text" id="editActivityEquipment" class="input-field" placeholder="Ausrüstung (kommagetrennt)">
                <textarea id="editActivityRules" class="input-field" placeholder="Regeln (optional)" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveActivityEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeActivityEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Time Booking Modal -->
    <div id="editTimeBookingModal" class="modal">
        <div class="modal-content">
            <h2>🎱 Buchung bearbeiten</h2>
            <div class="input-group">
                <select id="editBookingCustomer" class="input-field" onchange="handleCustomerChange(this)">
                    <option value="">Laufkundschaft (Name eingeben)</option>
                </select>
                <input type="text" id="editBookingWalkInName" class="input-field" placeholder="Name für Laufkundschaft">
                
                <input type="date" id="editBookingDate" class="input-field">
                <input type="time" id="editBookingStartTime" class="input-field">
                
                <select id="editBookingActivity" class="input-field">
                    <!-- Options werden von timeBookings.js gefüllt -->
                </select>
                
                <select id="editBookingDuration" class="input-field">
                    <!-- Options werden von timeBookings.js gefüllt -->
                </select>
                
                <input type="number" id="editBookingParticipants" class="input-field" min="1" max="10" placeholder="Teilnehmer">
                
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editBookingPaid">
                    <span>Bezahlt</span>
                </label>
                
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editBookingCompleted">
                    <span>Abgeschlossen</span>
                </label>
                
                <textarea id="editBookingNotes" class="input-field" placeholder="Notizen (optional)" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveTimeBookingEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeTimeBookingEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <h2>👥 Neuer Mitarbeiter</h2>
            <div class="input-group">
                <input type="text" id="newEmployeeFirstName" class="input-field" placeholder="Vorname">
                <input type="text" id="newEmployeeLastName" class="input-field" placeholder="Nachname">
                <select id="newEmployeeRank" class="input-field" onchange="updateHourlyRateFromRank(this.value, 'newEmployeeHourlyRate')">
                    <option value="Aushilfe">Aushilfe</option>
                    <option value="Teilzeit">Teilzeit</option>
                    <option value="Vollzeit">Vollzeit</option>
                    <option value="Senior">Senior</option>
                    <option value="Manager">Manager</option>
                </select>
                <input type="number" id="newEmployeeHourlyRate" class="input-field" placeholder="Stundenlohn (€)" step="0.01">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="addEmployee()">👥 Mitarbeiter hinzufügen</button>
                <button class="btn" onclick="hideModal('employeeModal')">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Employee Modal -->
    <div id="editEmployeeModal" class="modal">
        <div class="modal-content">
            <h2>👥 Mitarbeiter bearbeiten</h2>
            <div class="input-group">
                <input type="text" id="editEmployeeFirstName" class="input-field" placeholder="Vorname">
                <input type="text" id="editEmployeeLastName" class="input-field" placeholder="Nachname">
                <select id="editEmployeeRank" class="input-field" onchange="updateHourlyRateFromRank(this.value, 'editEmployeeHourlyRate')">
                    <option value="Aushilfe">Aushilfe</option>
                    <option value="Teilzeit">Teilzeit</option>
                    <option value="Vollzeit">Vollzeit</option>
                    <option value="Senior">Senior</option>
                    <option value="Manager">Manager</option>
                </select>
                <input type="number" id="editEmployeeHourlyRate" class="input-field" placeholder="Stundenlohn (€)" step="0.01">
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editEmployeeActive" checked>
                    <span>Mitarbeiter ist aktiv</span>
                </label>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveEmployeeEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeEmployeeEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Item Modal -->
    <div id="editItemModal" class="modal">
        <div class="modal-content">
            <h2>📦 Item bearbeiten</h2>
            <div class="input-group">
                <input type="text" id="editItemName" class="input-field" placeholder="Item Name">
                <input type="number" id="editItemSellPrice" class="input-field" placeholder="Verkaufspreis" step="0.01">
            </div>
            
            <h3>Materialien bearbeiten:</h3>
            <div id="editItemMaterialList">
                <!-- Material selection wird von items.js gefüllt -->
            </div>
            <button class="btn" onclick="addMaterialToEditItem()">+ Material hinzufügen</button>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveItemEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeItemEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Material Modal -->
    <div id="editMaterialModal" class="modal">
        <div class="modal-content">
            <h2>🏭 Material bearbeiten</h2>
            <div class="input-group">
                <input type="text" id="editMaterialName" class="input-field" placeholder="Material Name">
                <input type="number" id="editMaterialPrice" class="input-field" placeholder="Preis pro Einheit" step="0.01">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="saveMaterialEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeMaterialEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>
	
	<!-- Edit Sale Modal -->
    <div id="editSaleModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h2 style="margin-bottom: 20px; color: var(--accent-primary);">Verkauf bearbeiten</h2>
            
            <div class="input-group">
                <select id="editSaleCustomer" class="input-field">
                    <option value="">Laufkundschaft</option>
                </select>
                <input type="date" id="editSaleDate" class="input-field">
                <select id="editSaleType" class="input-field">
                    <option value="regular">Regulärer Verkauf</option>
                    <option value="bulk">Großbestellung</option>
                    <option value="special">Sonderverkauf</option>
                </select>
                <label style="display: flex; align-items: center; color: var(--text-primary); gap: 8px; margin: 10px 0;">
                    <input type="checkbox" id="editSalePaid">
                    <span>Bezahlt</span>
                </label>
                <textarea id="editSaleNotes" class="input-field" placeholder="Notizen" rows="2"></textarea>
            </div>
            
            <h3 style="margin: 20px 0 15px 0;">Items bearbeiten:</h3>
            <div id="editItemSelectionList" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Item-Bearbeitung wird hier dynamisch eingefügt -->
            </div>
            
            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px; color: var(--accent-primary);">Zusammenfassung:</h4>
                <div id="editSaleSummary">
                    <!-- Bearbeitungs-Zusammenfassung wird hier eingefügt -->
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="saveSaleEdit()">💾 Speichern</button>
                <button class="btn" onclick="closeSaleEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Edit Purchase Modal -->
    <div id="editPurchaseModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h2 style="margin-bottom: 20px; color: var(--accent-primary);">Einkauf bearbeiten</h2>
            
            <div class="input-group">
                <input type="date" id="editPurchaseDate" class="input-field">
                <select id="editPurchaseSupplier" class="input-field">
                    <option value="default">Unbekannt</option>
                </select>
                <select id="editPurchaseCategory" class="input-field">
                    <option value="regular">Regulärer Einkauf</option>
                </select>
                <input type="text" id="editPurchaseInvoice" class="input-field" placeholder="Rechnungsnummer">
                <textarea id="editPurchaseNotes" class="input-field" placeholder="Notizen" rows="2"></textarea>
            </div>
            
            <h3 style="margin: 20px 0 15px 0;">Materialien bearbeiten:</h3>
            <div id="editMaterialSelectionList" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Material-Bearbeitung wird hier dynamisch eingefügt -->
            </div>
            
            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px; color: var(--accent-primary);">Zusammenfassung:</h4>
                <div id="editPurchaseSummary">
                    <!-- Bearbeitungs-Zusammenfassung wird hier eingefügt -->
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="savePurchaseEdit()">💾 Speichern</button>
                <button class="btn" onclick="closePurchaseEditModal()">❌ Abbrechen</button>
            </div>
        </div>
    </div>

    <script src="database.js"></script>
    <script src="themes.js"></script>
    <script src="items.js"></script>
    <script src="employees.js"></script>
    <script src="customers.js"></script>
    <script src="timeBookings.js"></script>
    <script src="sales.js"></script>
    <script src="materialPurchases.js"></script>
    <script src="bilanz.js"></script>
    <script src="renderTemplates.js"></script>
    <script src="ui.js"></script>
    
    <!-- INLINE-JS wie gehabt -->
    <script>
        // Clear Import Text Funktion
        function clearImportText() {
            const importText = document.getElementById('importText');
            if (importText) {
                importText.value = '';
                if (typeof showNotification === 'function') {
                    showNotification('Import-Text gelöscht!', 'success');
                }
            }
        }
        // Mobile-spezifische Event Listener
        document.addEventListener('DOMContentLoaded', function() {
            let touchStartY = 0;
            let touchEndY = 0;
            document.addEventListener('touchstart', function(e) {
                touchStartY = e.changedTouches[0].screenY;
            });
            document.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].screenY;
                handleSwipe();
            });
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartY - touchEndY;
                if (Math.abs(diff) > swipeThreshold) {
                    // Swipe up/down detected
                }
            }
            // Keyboard shortcuts für Desktop
            document.addEventListener('keydown', function(e) {
                if (e.altKey && !isNaN(e.key)) {
                    e.preventDefault();
                    const tabNumber = parseInt(e.key);
                    const tabMapping = {
                        1: 'calculator',
                        2: 'time-bookings',
                        3: 'sales-daily',
                        4: 'material-purchases',
                        5: 'bilanz-daily',
                        6: 'employees-overview',
                        7: 'settings'
                    };
                    if (tabMapping[tabNumber] && typeof showTab === 'function') {
                        showTab(tabMapping[tabNumber]);
                    }
                }
                if (e.key === 'F1') {
                    e.preventDefault();
                    if (typeof showNotification === 'function') {
                        showNotification('Company OS - Verwenden Sie Alt+Nummer für schnelle Navigation!', 'info');
                    }
                }
            });
            // Auto-save bei Eingaben
            let autoSaveTimeout;
            const autoSaveInputs = document.querySelectorAll('.input-field');
            autoSaveInputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(() => {
                        if (typeof saveData === 'function') {
                            saveData();
                        }
                    }, 5000);
                });
            });
            window.addEventListener('online', function() {
                if (typeof showNotification === 'function') {
                    showNotification('✅ Internetverbindung wiederhergestellt!', 'success');
                }
            });
            window.addEventListener('offline', function() {
                if (typeof showNotification === 'function') {
                    showNotification('⚠️ Keine Internetverbindung - Arbeite im Offline-Modus', 'warning');
                }
            });
            setTimeout(() => {
                const loadTime = performance.now();
                console.log(`🚀 Company OS geladen in ${Math.round(loadTime)}ms`);
                if (loadTime > 3000 && typeof showNotification === 'function') {
                    showNotification('⚠️ Längere Ladezeit erkannt - Prüfen Sie Ihre Internetverbindung', 'warning');
                }
            }, 100);
            document.addEventListener('visibilitychange', function() {
                if (document.hidden && typeof saveData === 'function') {
                    saveData();
                }
            });
            window.addEventListener('beforeunload', function(e) {
                if (typeof saveData === 'function') {
                    saveData();
                }
            });
            console.log('🎉 Company OS - Erweiterte Event Listener initialisiert');
        });
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                console.log('🔧 Service Worker Support verfügbar');
            });
        }
        window.addEventListener('error', function(e) {
            console.error('❌ Globaler Fehler:', e.error);
            if (typeof showNotification === 'function') {
                showNotification('⚠️ Ein Fehler ist aufgetreten - Daten wurden gesichert', 'error');
            }
            if (typeof saveData === 'function') {
                saveData();
            }
        });
        window.addEventListener('unhandledrejection', function(e) {
            console.error('❌ Unbehandelte Promise Rejection:', e.reason);
            if (typeof showNotification === 'function') {
                showNotification('⚠️ Ein asynchroner Fehler ist aufgetreten', 'warning');
            }
        });
        window.CompanyOS = {
            version: '3.0',
            modules: ['database', 'themes', 'items', 'employees', 'customers', 'timeBookings', 'sales', 'materialPurchases', 'bilanz', 'ui'],
            debug: {
                showAllData: function() {
                    console.log('📊 Alle Daten:', {
                        items: window.items || [],
                        materials: window.materials || [],
                        employees: window.employees || [],
                        customers: window.customers || [],
                        timeBookings: window.timeBookings || [],
                        sales: window.sales || [],
                        materialPurchases: window.materialPurchases || [],
                        workSessions: window.workSessions || []
                    });
                },
                clearAllData: function() {
                    if (confirm('🚨 Wirklich ALLE Daten löschen? Dies kann nicht rückgängig gemacht werden!')) {
                        localStorage.clear();
                        location.reload();
                    }
                },
                exportDebugInfo: function() {
                    const debugInfo = {
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        viewport: `${window.innerWidth}x${window.innerHeight}`,
                        modules: this.parent.modules,
                        version: this.parent.version,
                        localStorage: Object.keys(localStorage).filter(key => key.startsWith('company-os'))
                    };
                    console.log('🐛 Debug Info:', debugInfo);
                    return debugInfo;
                }
            }
        };
        setTimeout(() => {
            const requiredFunctions = ['showTab', 'saveData', 'updateDisplay'];
            const missingFunctions = requiredFunctions.filter(fn => typeof window[fn] !== 'function');
            if (missingFunctions.length > 0) {
                console.warn('⚠️ Fehlende Funktionen:', missingFunctions);
            } else {
                console.log('✅ Alle Kern-Funktionen verfügbar');
            }
        }, 2000);
    </script>
    <!-- Meta-Tags für PWA (Progressive Web App) - Optional -->
    <script>
        // Dynamisches PWA Manifest
        const manifest = {
            "name": "Company OS - Business Management Suite",
            "short_name": "CompanyOS",
            "description": "Vollständige Business Management Lösung",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#1e3c72",
            "theme_color": "#ffd700",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxZTNjNzIiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjZmZkNzAwIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgo8L3N2Zz4K",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        if ('serviceWorker' in navigator) {
            const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            const link = document.createElement('link');
            link.rel = 'manifest';
            link.href = manifestURL;
            document.head.appendChild(link);
            console.log('📱 PWA Manifest hinzugefügt');
        }
    </script>
</body>
</html>